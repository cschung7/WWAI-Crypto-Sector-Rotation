<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Scanner | Crypto Sector Rotation</title>
    <!-- Version: 2026.02.03.v2 - India-style implementation -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }
        .header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 1.5rem 2rem;
        }
        .header h1 { font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; }
        .header p { color: #94a3b8; }
        .market-flag { font-size: 2rem; margin-right: 0.5rem; color: #F7931A; }
        .nav-links { display: flex; gap: 1rem; margin-top: 1rem; }
        .nav-links a {
            color: #94a3b8;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .nav-links a:hover, .nav-links a.active { background: #334155; color: #f8fafc; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .summary-card {
            background: #1e293b;
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #334155;
            text-align: center;
        }
        .summary-value { font-size: 2rem; font-weight: bold; }
        .summary-value.green { color: #10b981; }
        .summary-value.blue { color: #3b82f6; }
        .summary-value.yellow { color: #f59e0b; }
        .summary-value.pink { color: #f472b6; }
        .summary-value.purple { color: #8b5cf6; }
        .summary-label { font-size: 0.75rem; color: #94a3b8; margin-top: 0.25rem; }
        .summary-date { font-size: 0.6875rem; color: #64748b; margin-top: 0.5rem; }

        .card {
            background: #1e293b;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #334155;
            margin-bottom: 1.5rem;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #334155;
        }
        .card-title { font-size: 1.25rem; font-weight: 600; }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .chart-container {
            background: #1e293b;
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid #334155;
        }
        .chart-container h3 { font-size: 0.875rem; margin-bottom: 0.75rem; color: #94a3b8; }
        .chart-wrapper { height: 200px; position: relative; }

        /* Filters */
        .filters { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; }
        .filter-group { display: flex; flex-direction: column; gap: 0.25rem; }
        .filter-label { font-size: 0.75rem; color: #94a3b8; }
        select, input {
            background: #334155;
            border: 1px solid #475569;
            color: #f8fafc;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        select:focus, input:focus { outline: none; border-color: #3b82f6; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #334155; font-weight: 600; font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; }
        tr:hover { background: #334155; }

        /* Badges */
        .stage-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.6875rem;
            font-weight: 600;
        }
        .stage-badge.super-trend { background: #10b981; color: white; }
        .stage-badge.early-breakout { background: #3b82f6; color: white; }
        .stage-badge.burgeoning { background: #8b5cf6; color: white; }
        .stage-badge.building { background: #f59e0b; color: black; }
        .stage-badge.consolidation { background: #6b7280; color: white; }
        .stage-badge.bear-volatile { background: #ef4444; color: white; }

        .priority-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.6875rem;
            font-weight: 600;
        }
        .priority-badge.HIGH { background: #10b981; color: white; }
        .priority-badge.MEDIUM { background: #3b82f6; color: white; }
        .priority-badge.LOW { background: #f59e0b; color: black; }
        .priority-badge.AVOID { background: #ef4444; color: white; }

        /* Score Bar */
        .score-bar {
            width: 60px;
            height: 6px;
            background: #475569;
            border-radius: 3px;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.5rem;
        }
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 3px;
        }

        .deviation-positive { color: #10b981; }
        .deviation-negative { color: #ef4444; }

        .loading { text-align: center; padding: 2rem; color: #94a3b8; }

        @media (max-width: 1100px) {
            .summary-cards { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 900px) {
            .summary-cards { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
            .filters { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container" style="padding: 0;">
            <h1><span class="market-flag">&#129689;</span>Momentum Scanner</h1>
            <p>Early Breakout & Momentum Candidates (Crypto)</p>
            <nav class="nav-links">
                <a href="index.html">Overview</a>
                <a href="breakout.html" class="active">Breakout</a>
                <a href="signals.html">Signals</a>
                <a href="cohesion.html">Cohesion</a>
                <a href="network.html">Network</a>
            </nav>
        </div>
    </div>

    <div class="container">
        <!-- Summary Cards (5 cards) -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-value green" id="supertrendCount">--</div>
                <div class="summary-label">Super Trend</div>
            </div>
            <div class="summary-card">
                <div class="summary-value blue" id="earlyBreakoutCount">--</div>
                <div class="summary-label">Early Breakout</div>
            </div>
            <div class="summary-card">
                <div class="summary-value yellow" id="highPriorityCount">--</div>
                <div class="summary-label">High Priority</div>
            </div>
            <div class="summary-card">
                <div class="summary-value pink" id="longTermTrendCount">--</div>
                <div class="summary-label">Long Term Trend</div>
                <div class="summary-date">BB(220,2) Breakout</div>
            </div>
            <div class="summary-card">
                <div class="summary-value purple" id="totalCount">--</div>
                <div class="summary-label">Total Categories</div>
                <div class="summary-date" id="dataDate">Data as of: --</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3>Stage Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="stageChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>Expected Returns by Stage (20D)</h3>
                <div class="chart-wrapper">
                    <canvas id="returnsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Daily Top Performers -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Daily Top Performers</span>
                <span id="performersDate" style="color: #94a3b8; font-size: 0.875rem;"></span>
            </div>
            <div id="performersTable">
                <div class="loading">Loading top performers...</div>
            </div>
        </div>

        <!-- Long Term Trend Breakout (BB 220,2 Crossover) -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Long Term Trend Breakout</span>
                <span id="bbNote" style="color: #f472b6; font-size: 0.75rem;">BB(220, 2.0) Crossover</span>
            </div>
            <div id="longTermTrendTable">
                <div class="loading">Loading BB crossover candidates...</div>
            </div>
        </div>

        <!-- Breakout Candidates -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Breakout Candidates</span>
                <span id="resultCount" style="color: #94a3b8; font-size: 0.875rem;">Loading...</span>
            </div>
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Stage</label>
                    <select id="stageFilter" onchange="loadBreakoutCandidates()">
                        <option value="">All Stages</option>
                        <option value="Super Trend">Super Trend</option>
                        <option value="Early Breakout">Early Breakout</option>
                        <option value="Burgeoning">Burgeoning</option>
                        <option value="Building">Building</option>
                        <option value="Consolidation">Consolidation</option>
                        <option value="Bear Volatile">Bear Volatile</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Priority</label>
                    <select id="priorityFilter" onchange="loadBreakoutCandidates()">
                        <option value="">All</option>
                        <option value="HIGH">HIGH</option>
                        <option value="MEDIUM">MEDIUM</option>
                        <option value="LOW">LOW</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Min Score</label>
                    <input type="number" id="minScoreFilter" placeholder="0" min="0" max="100" onchange="loadBreakoutCandidates()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Category</label>
                    <input type="text" id="categoryFilter" placeholder="e.g., defi" onchange="loadBreakoutCandidates()">
                </div>
            </div>
            <div id="breakoutTable">
                <div class="loading">Loading breakout candidates...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let stageChart = null;
        let returnsChart = null;

        async function loadDashboard() {
            await Promise.all([
                loadSummaryCards(),
                loadStageDistribution(),
                loadExpectedReturns(),
                loadDailySummary(),
                loadLongTermTrendBreakout(),
                loadBreakoutCandidates()
            ]);
        }

        async function loadSummaryCards() {
            try {
                const response = await fetch(`${API_BASE}/api/breakout/summary-cards`);
                const data = await response.json();

                document.getElementById('supertrendCount').textContent = data.supertrend || 0;
                document.getElementById('earlyBreakoutCount').textContent = data.early_breakout || 0;
                document.getElementById('highPriorityCount').textContent = data.high_priority || 0;
                document.getElementById('longTermTrendCount').textContent = data.long_term_trend || 0;
                document.getElementById('totalCount').textContent = data.total || 0;
                document.getElementById('dataDate').textContent = `Data as of: ${data.date || '--'}`;
            } catch (error) {
                console.error('Error loading summary:', error);
            }
        }

        async function loadStageDistribution() {
            try {
                const response = await fetch(`${API_BASE}/api/breakout/stages`);
                const data = await response.json();

                const ctx = document.getElementById('stageChart').getContext('2d');
                if (stageChart) stageChart.destroy();

                const stages = data.stages || [];
                const colors = {
                    'Super Trend': '#10b981',
                    'Early Breakout': '#3b82f6',
                    'Burgeoning': '#8b5cf6',
                    'Building': '#f59e0b',
                    'Consolidation': '#6b7280',
                    'Bear Volatile': '#ef4444',
                };

                stageChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: stages.map(s => s.name),
                        datasets: [{
                            data: stages.map(s => s.count),
                            backgroundColor: stages.map(s => colors[s.name] || '#475569'),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: { color: '#94a3b8', font: { size: 11 } }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading stage distribution:', error);
            }
        }

        async function loadExpectedReturns() {
            try {
                const response = await fetch(`${API_BASE}/api/breakout/expected-returns`);
                const data = await response.json();

                const ctx = document.getElementById('returnsChart').getContext('2d');
                if (returnsChart) returnsChart.destroy();

                const stages = data.stages || [];
                returnsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: stages.map(s => s.stage),
                        datasets: [{
                            label: 'Expected 20D Return %',
                            data: stages.map(s => s.return_20d),
                            backgroundColor: stages.map(s => s.return_20d >= 0 ? '#10b981' : '#ef4444'),
                            borderWidth: 0
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                grid: { color: '#334155' },
                                ticks: { color: '#94a3b8', font: { size: 11 } }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: '#94a3b8', font: { size: 11 } }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading expected returns:', error);
            }
        }

        async function loadDailySummary() {
            try {
                const response = await fetch(`${API_BASE}/api/breakout/daily-summary`);
                const data = await response.json();

                const container = document.getElementById('performersTable');
                document.getElementById('performersDate').textContent = data.date ? `Date: ${data.date}` : '';

                if (data.top_performers && data.top_performers.length > 0) {
                    let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Ticker</th>
                                    <th>Category</th>
                                    <th>Score</th>
                                    <th>Tier</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    data.top_performers.forEach(p => {
                        const scorePct = Math.min(100, p.composite_score * 100);
                        html += `
                            <tr>
                                <td><strong>#${p.rank}</strong></td>
                                <td><strong>${p.ticker}</strong></td>
                                <td>${p.category || '-'}</td>
                                <td>
                                    ${(p.composite_score * 100).toFixed(1)}
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${scorePct}%"></div>
                                    </div>
                                </td>
                                <td>${p.regime_type || '-'}</td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">Daily summary not available</p>';
                }
            } catch (error) {
                console.error('Error loading daily summary:', error);
                document.getElementById('performersTable').innerHTML = '<p style="color: #64748b; text-align: center;">No daily data available</p>';
            }
        }

        async function loadLongTermTrendBreakout() {
            try {
                const response = await fetch(`${API_BASE}/api/breakout/supertrend-candidates`);
                const data = await response.json();

                const container = document.getElementById('longTermTrendTable');

                if (data.candidates && data.candidates.length > 0) {
                    let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Ticker</th>
                                    <th>Category</th>
                                    <th>Score</th>
                                    <th>Priority</th>
                                    <th>Deviation</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    data.candidates.forEach(t => {
                        const deviationClass = t.deviation >= 0 ? 'deviation-positive' : 'deviation-negative';
                        const deviationSign = t.deviation >= 0 ? '+' : '';
                        const scorePct = Math.min(100, t.score);

                        html += `
                            <tr>
                                <td><strong style="color: #10b981;">${t.ticker}</strong></td>
                                <td style="font-size: 0.8rem;">${t.category || '-'}</td>
                                <td>
                                    ${t.score}
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${scorePct}%"></div>
                                    </div>
                                </td>
                                <td><span class="priority-badge ${t.priority}">${t.priority}</span></td>
                                <td class="${deviationClass}">${deviationSign}${t.deviation.toFixed(2)}%</td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No BB(220,2) crossover signals today</p>';
                }
            } catch (error) {
                console.error('Error loading Long Term Trend:', error);
                document.getElementById('longTermTrendTable').innerHTML = '<p style="color: #ef4444; text-align: center;">Error loading BB crossover data</p>';
            }
        }

        async function loadBreakoutCandidates() {
            const stage = document.getElementById('stageFilter').value;
            const priority = document.getElementById('priorityFilter').value;
            const minScore = document.getElementById('minScoreFilter').value;
            const category = document.getElementById('categoryFilter').value;

            let url = `${API_BASE}/api/breakout/candidates?limit=100`;
            if (stage) url += `&stage=${encodeURIComponent(stage)}`;
            if (priority) url += `&priority=${encodeURIComponent(priority)}`;
            if (minScore) url += `&min_score=${minScore}`;
            if (category) url += `&theme=${encodeURIComponent(category)}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                document.getElementById('resultCount').textContent = `${data.count || 0} of ${data.total_available || 0} shown`;

                const container = document.getElementById('breakoutTable');
                if (data.candidates && data.candidates.length > 0) {
                    let html = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Ticker</th>
                                    <th>Score</th>
                                    <th>Stage</th>
                                    <th>Priority</th>
                                    <th>Strategy</th>
                                    <th>Category</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    data.candidates.forEach(c => {
                        const stageClass = c.stage.toLowerCase().replace(' ', '-');
                        const scorePct = Math.min(100, c.score);

                        html += `
                            <tr>
                                <td><strong>${c.ticker}</strong></td>
                                <td>
                                    ${c.score}
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${scorePct}%"></div>
                                    </div>
                                </td>
                                <td><span class="stage-badge ${stageClass}">${c.stage}</span></td>
                                <td><span class="priority-badge ${c.priority}">${c.priority}</span></td>
                                <td>${c.strategy || '-'}</td>
                                <td>${c.themes || '-'}</td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 2rem;">No candidates found with current filters</p>';
                }
            } catch (error) {
                console.error('Error loading breakout candidates:', error);
                document.getElementById('breakoutTable').innerHTML = '<p style="color: #ef4444; text-align: center;">Error loading data</p>';
            }
        }

        // Initialize
        loadDashboard();
    </script>
</body>
</html>
